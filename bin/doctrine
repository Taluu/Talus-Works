#!/usr/bin/env php
<?php

use \Doctrine\DBAL\Tools\Console\Helper\ConnectionHelper,
    \Doctrine\DBAL\Tools\Console\Command as DBALCommand,

    \Doctrine\ORM\Tools\Console\Helper\EntityManagerHelper,
    \Doctrine\ORM\Tools\Console\Command as ORMCommand,

    \Doctrine\Common\Version;

use \Symfony\Component\Console\Application as ConsoleApplication;

use \Talus_Works\Application;

require __DIR__ . '/../app/autoload.php';

$app = new Application;

$helpers = ['db' => new ConnectionHelper($app['orm.em']->getConnection()),
            'em' => new EntityManagerHelper($app['orm.em'])];

$cli = new ConsoleApplication('Doctrine Command Line Interface', Version::VERSION);
$cli->setCatchExceptions(true);

$helperSet = $cli->getHelperSet();

foreach ($helpers as $name => $helper) {
    $helperSet->set($helper, $name);
}

$cli->addCommands(array(
    // DBAL Commands
    new DBALCommand\RunSqlCommand(),
    new DBALCommand\ImportCommand(),

    // ORM Commands
    new ORMCommand\ClearCache\MetadataCommand(),
    new ORMCommand\ClearCache\ResultCommand(),
    new ORMCommand\ClearCache\QueryCommand(),
    new ORMCommand\ConvertDoctrine1SchemaCommand(),
    new ORMCommand\GenerateRepositoriesCommand(),
    new ORMCommand\GenerateProxiesCommand(),
    new ORMCommand\RunDqlCommand(),
    new ORMCommand\InfoCommand(),
    new ORMCommand\ValidateSchemaCommand(),
));

$cli->run();

